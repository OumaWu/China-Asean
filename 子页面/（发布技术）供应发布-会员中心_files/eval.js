if(typeof(k8008_alert)=="undefined"){k8008_alert=alert}function MyAlert(c,e){k8008_alert(c);if(!!e&&typeof(e)=="string"){}}function OnAdd(b){if($("#tecname").val()==""||$("#tecname").val()==" "){MyAlert("请填写技术名称","tecname");document.getElementById("tecname").focus();return}if(OnVer()){OnAddConfirm()}}function OnAddConfirm(){$.ajax({url:"/server/eval/save/",data:$("#f1").serialize(),dataType:"json",type:"post",cache:false,success:function(b){switch(b.code){case -1:MyAlert(b.msg);break;case 0:MyAlert(b.msg);break;case 1:alert(b.msg||"评估成功");window.location.href="/eval/list/";break;case 6:MyAlert("评估结果小于或等于零，请重新填写参数后提交评估");break}},error:function(b){MyAlert(b)}})}function OnVer(){if($("#evtype").val()=="0"){return OnVer_yq()}else{return OnVer_cz()}}function OnVer_cz(){if($("#tecname").val()==""||$("#tecname").val()==" "){MyAlert("请填写技术名称","");document.getElementById("tecname").focus();return}var o=$("#tecid").find("option:selected").attr("ispatent");$("input[name=PatentType1],input[name=PatentType0]").filter(":checked");var q=$("input[name=PatentType1],input[name=PatentType0]").filter(":checked");if(q.length==0){MyAlert("请选择技术形态","");return false}if($(q[0]).attr("name")=="PatentType1"){$("#IsPatent").val("1")}else{$("#IsPatent").val("0")}var b=$("#DevTime").val();if(b==""){MyAlert("开发年份不能为空","DevTime");return false}var m=10;if(o=="1"&&d=="0"){m=20}var p=new Date();var n=p.getFullYear();if(parseInt(b)>n){MyAlert("开发年份大于当前时间","DevTime");return false}if(parseInt(b)<(n-m)){MyAlert("开发年份高于法定使用年限","DevTime");return false}var c=[{id:"NengYuanFei",vervalue:"能源费不能为空"},{id:"CaiLiuoFei",vervalue:"材料费不能为空"},{id:"ZhuanYongSheBeiFei",vervalue:"专用设备费不能为空"},{id:"WaiXieFei",vervalue:"外协费不能为空"},{id:"ZiXunJianDingFei",vervalue:"咨询鉴定费不能为空"},{id:"PeiXunFei",vervalue:"培训费不能为空"},{id:"ChaLuFei",vervalue:"差旅费不能为空"},{id:"YanJiuRenYuanGongZi",vervalue:"研究人员工资不能为空"},{id:"QiTaFeiYong",vervalue:"其他费用不能为空"},{id:"GuanLiFei",vervalue:"管理费不能为空"},{id:"SheJiuFei",vervalue:"折旧费不能为空"},{id:"TanXiaoFei",vervalue:"摊销费不能为空"}];for(i=0;i<c.length;i++){var l=document.getElementById(c[i].id).value;if(l==""){MyAlert(c[i].vervalue,c[i].id);return false}}return true}function InitRadio(h,e){var g=new Object();g=document.getElementsByName(h);for(var f=0;f<g.length;f++){if(e==g[f].value){g[f].checked=true}}}function InitSelect(e,h){var g=new Object();g=document.getElementById(e);for(var f=0;f<g.options.length;f++){if(h==g.options[f].value){g.options[f].selected=true}}}function VerInt(e,g){var f=document.getElementById(e).value;if(!f){MyAlert(g,e);return false}if(!f.match(/^\d+(\.\d+)?$/)){$("#"+e).val("");MyAlert(g,e);return false}return true}function VerFloat(e,g){var f=document.getElementById(e).value;if(f==""){MyAlert(g[0],e);return false}if(!f.match(/^\d+(\.\d+)?$/)){MyAlert(g[1],e);return false}return true}function OnVer_yq(){if($("#tecname").val()==""||$("#tecname").val()==" "){MyAlert("请填写技术名称","");document.getElementById("tecname").focus()}if($("#mycls").val()==""){MyAlert("请选择行业分类","mycls");document.getElementById("cls1").focus();return false}var a=$("input[name=PatentType1],input[name=PatentType0]").filter(":checked");if(a.length==0){MyAlert("请选择技术形态","");return false}if($(a[0]).attr("name")=="PatentType1"){$("#IsPatent").val("1")}else{$("#IsPatent").val("0")}switch($("input[name=MarketProfitMode]").filter(":checked").val()){case"0":if(!VerFloat("BeforeCommondityPrice",new Array("改造前的商品单价不能为空","改造前的商品单价只能是数字"))){return false}if(!VerFloat("BeforeSalesPrice",new Array("改造前的单位成本不能为空","改造前的单位成本只能是数字"))){return false}if(!VerInt("BeforeAnnuaSales",new Array("改造前的年销售量不能为空","改造前的年销售量只能是数字"))){return false}if(!VerFloat("AfterCommondityPrice",new Array("改造后的商品单价不能为空","改造后的预计售价只能是数字"))){return false}if(!VerFloat("AfterSalesPrice",new Array("改造后的单位成本不能为空","改造后的单位成本只能是数字"))){return false}if(!VerInt("AfterAnnuaSales",new Array("改造后的年销售量不能为空","改造后的年销售量只能是数字"))){return false}break;case"1":if(!VerFloat("PreSalesPrice",new Array("销售单价不能为空","销售单价只能是数字"))){return false}if(!VerFloat("PreUnitCost",new Array("单位成本不能为空","单位成本只能是数字"))){return false}if(!VerInt("PreAnnuaSales",new Array("年销售量不能为空","年销售量只能是数字"))){return false}break;case"2":if(!VerInt("PreAnnualProfit",new Array("预估年均利润不能为空","预估年均利润只能是数字"))){return false}break}return true}function cleanyq(){$("#f1 :text,#mycls,#mybigcls,#mymidcls").val("");$("#TranferProvince,#Mature").val("0");$("#TranferType").val("0").trigger("change");$("input[name=IsCompetior][value=0]").prop("checked",true);$("input[name=PatentType0]").prop("checked",false);$("#clslistdis option").remove();$("#bigcls1").val("").trigger("change")}function cleancz(){$("#f1 :text").val("");$("input[name=PatentType1],input[name=PatentType0]").prop("checked",false)}function tec_selected(){$("#tecname,#tecidname").val($("#tecid option").filter(":checked").text())}function tec_yifabu(b){var c=location.search.replace(/^(\?tid=(\d+))/,"$2");var a=false;$.ajax({type:"get",url:"/server/tec/evaljsgldata?pagesize="+b+"&checkstatus=1&pageindex=1",dataType:"json",cache:false,contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(g){var f="";f+='<option  value="{id}">{tecname}</option>';var e="";if(g.data!=null){var h=g.data;$.each(h,function(j){e+=f.replace("{tecname}",h[j].tecname).replace("{id}",h[j].ID);if(h[j].ID==c){a=true}})}$("#tecid").append(e);if(a){$("#tecid").val(c).trigger("click")}else{if(c>0){$.ajax({type:"get",url:"/server/tec/data?tid="+c,dataType:"json",cache:false,contentType:"application/x-www-form-urlencoded; charset=utf-8",success:function(j){if(!!j.ID&&!!j.tecname){PingguDal.setTecName();$("#tecname").val(j.tecname)}}})}}if(!e){$(".tecno,#tecInput").show();$(".tecyes,#tecid,#tecToggle").hide()}}})}var issubmit=false;var PingguDal={locked:false,msg:function(a){this.locked=false;$("#btnsubmit").html("确定").attr("class","bc_b3");if(a){alert(a)}},add:function(){if(issubmit){return}issubmit=true;var a=this;if(!a.locked){a.locked=true;var b=$("#btnsubmit");$("#btnsubmit").html("数据提交中...").attr("class","bc_b3a");if($("#tecname").val()==""||$("#tecname").val()==" "){a.msg("请填写技术名称");document.getElementById("tecname").focus();issubmit=false;return}if(!OnVer()){a.msg();issubmit=false;return}$.ajax({url:"/server/eval/save/",data:$("#f1").serialize(),dataType:"json",type:"post",cache:false,beforeSend:function(){},complete:function(){issubmit=false},success:function(c){switch(c.code){case -1:a.msg(c.msg);break;case 0:a.msg(c.msg);break;case 1:if(c.type==1){eval_tongji(2,2)}else{if(c.type==0){eval_tongji(2,1)}}a.msg(c.msg||"评估成功");window.location.href="/eval/list/";break;case 6:a.msg("评估结果小于或等于零，请重新填写参数后提交评估");break}},error:function(c){a.msg("提交失败！")}})}},istec:true,setTecName:function(){var a=this;a.istec=!a.istec;if(a.istec){$("#tecToggle").html("手动输入技术名称");$("#tecInput").hide()}else{$("#tecToggle").html("取消手动输入");$("#tecInput").show();$("#tecSelect").hide();$("#tecid,#tecname,#tecidname").val("")}},selected:function(){var a=$("#tecid option").filter(":checked").text();$("#tecSelect span").html(a);$("#tecname,#tecidname").val(a);$("#tecSelect").show();$("#tecInput").hide();if(!this.istec){$("#tecToggle").trigger("click")}}};function eval_tongji(a,b){try{var f=getCookie("K8008_LCAUTH_USERNAME");$.ajax({url:apiDomain+"/tongji/PingguTongji/",type:"get",dataType:"jsonp",data:"username="+f+"&pageurl="+document.URL+"&operation="+a+"&systemtype=1&stype="+b,cache:false,success:function(e){}})}catch(c){}};